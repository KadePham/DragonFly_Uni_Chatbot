# Admin-User Chat System - Visual Diagrams & Quick Reference

## ğŸ“± User Interface Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        MainActivity             â”‚
â”‚   (Main Chat Interface)         â”‚
â”‚                                 â”‚
â”‚  [â‰¡ Menu]         [Chat Title]  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Message 1                  â”‚â”‚
â”‚  â”‚  Message 2                  â”‚â”‚
â”‚  â”‚  ...                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [EditText] [Send Button]    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘ User clicks "Admin Support"
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AdminChatActivity             â”‚
â”‚ (Chat with Admin Support)       â”‚
â”‚                                 â”‚
â”‚  [â† Back]  Admin Support        â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚User Msg (blue, right)       â”‚â”‚
â”‚  â”‚12:30                        â”‚â”‚
â”‚  â”‚                             â”‚â”‚
â”‚  â”‚Admin Msg (gray, left)       â”‚â”‚
â”‚  â”‚12:31                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚[Input] [Send]              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ‘¨â€ğŸ’¼ Admin Interface Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    AdminInboxActivity            â”‚
â”‚  (Admin Support Inbox)           â”‚
â”‚                                  â”‚
â”‚  [â† Back]  Unread Messages       â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ User 1 (John)                â”‚â”‚ â† unread: 3
â”‚  â”‚ Last: "Can you help?"  5min  â”‚â”‚
â”‚  â”‚                              â”‚â”‚
â”‚  â”‚ User 2 (Jane)                â”‚â”‚ â† unread: 1
â”‚  â”‚ Last: "Hello" 10min          â”‚â”‚
â”‚  â”‚                              â”‚â”‚
â”‚  â”‚ User 3 (Mike)                â”‚â”‚ â† unread: 0
â”‚  â”‚ Last: "Thanks!" 1 hour       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘ Admin clicks on user
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AdminDashboardActivity         â”‚
â”‚   (Chat with John)               â”‚
â”‚                                  â”‚
â”‚  [â† Back]  Chat with John        â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚John (user)                   â”‚â”‚
â”‚  â”‚Can you help?                 â”‚â”‚ â† gray, left
â”‚  â”‚12:30                         â”‚â”‚
â”‚  â”‚                              â”‚â”‚
â”‚  â”‚Support Team (admin)          â”‚â”‚
â”‚  â”‚Of course!                    â”‚â”‚ â† blue, right
â”‚  â”‚12:31                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚[Input] [Send]               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Message Lifecycle Diagram

```
USER SENDS MESSAGE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User types "Hello admin"
        â†“
sendAdminMessage() called
        â†“
Message object created:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Message(                                â”‚
â”‚   id: "abc123",                         â”‚
â”‚   chatId: "admin_support",              â”‚
â”‚   content: "Hello admin",               â”‚
â”‚   timestamp: 1701920400000,             â”‚
â”‚   isUser: true,        â† KEY!           â”‚
â”‚   senderUid: "user123",                 â”‚
â”‚   senderName: "John",                   â”‚
â”‚   senderRole: "user"                    â”‚
â”‚ )                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Realtime DB write:
  messages/user123/admin_support/abc123
        â†“
Firestore update:
  admin_inbox/user123/ {
    unreadCount: +1,
    lastMessage: "Hello admin",
    lastMessageFromUser: true
  }
        â†“
User sees blue bubble (right)  âœ“
Admin sees notification âœ“

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ADMIN SENDS REPLY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Admin types "How can I help?"
        â†“
sendAdminReply(selectedUserUID) called
        â†“
Message object created:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Message(                                â”‚
â”‚   id: "def456",                         â”‚
â”‚   chatId: "admin_support",              â”‚
â”‚   content: "How can I help?",           â”‚
â”‚   timestamp: 1701920401000,             â”‚
â”‚   isUser: false,       â† KEY!           â”‚
â”‚   senderUid: "admin123",                â”‚
â”‚   senderName: "Support",                â”‚
â”‚   senderRole: "admin"                   â”‚
â”‚ )                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
Realtime DB write (USER's location!):
  messages/user123/admin_support/def456
        â†“
Firestore update:
  admin_inbox/user123/ {
    unreadCount: 0,
    lastMessage: "How can I help?",
    lastMessageFromUser: false
  }
        â†“
User sees gray bubble (left) âœ“
Admin sees: conversation replied âœ“
```

## ğŸ—„ï¸ Firebase Data Structure Visualization

```
FIREBASE REALTIME DATABASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

messages/
â”œâ”€â”€ user123/                          â† User A's UID
â”‚   â””â”€â”€ admin_support/
â”‚       â”œâ”€â”€ abc001: {
â”‚       â”‚   "id": "abc001",
â”‚       â”‚   "chatId": "admin_support",
â”‚       â”‚   "content": "Help!",
â”‚       â”‚   "timestamp": 1701920400000,
â”‚       â”‚   "isUser": true,           â† User message
â”‚       â”‚   "senderName": "John",
â”‚       â”‚   "senderRole": "user"
â”‚       â”‚ }
â”‚       â””â”€â”€ def001: {
â”‚           "id": "def001",
â”‚           "chatId": "admin_support",
â”‚           "content": "Sure!",
â”‚           "timestamp": 1701920401000,
â”‚           "isUser": false,          â† Admin message
â”‚           "senderName": "Support",
â”‚           "senderRole": "admin"
â”‚         }
â”‚
â”œâ”€â”€ user456/                          â† User B's UID
â”‚   â””â”€â”€ admin_support/
â”‚       â”œâ”€â”€ xyz001: { ... }
â”‚       â””â”€â”€ xyz002: { ... }
â”‚
â””â”€â”€ user789/                          â† User C's UID
    â””â”€â”€ admin_support/
        â””â”€â”€ qwe001: { ... }


FIRESTORE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

users/
â”œâ”€â”€ user123/
â”‚   â”œâ”€â”€ uid: "user123"
â”‚   â”œâ”€â”€ email: "john@gmail.com"
â”‚   â”œâ”€â”€ displayName: "John"
â”‚   â”œâ”€â”€ role: "user"                  â† User role
â”‚   â””â”€â”€ conversations/
â”‚       â””â”€â”€ admin_support/
â”‚           â”œâ”€â”€ id: "admin_support"
â”‚           â”œâ”€â”€ title: "Chat with Admin Support"
â”‚           â””â”€â”€ lastUpdated: 1701920401000
â”‚
â”œâ”€â”€ admin123/
â”‚   â”œâ”€â”€ uid: "admin123"
â”‚   â”œâ”€â”€ email: "admin@gmail.com"
â”‚   â”œâ”€â”€ displayName: "Admin"
â”‚   â”œâ”€â”€ role: "admin"                 â† Admin role
â”‚   â””â”€â”€ conversations/ { ... }
â”‚
â””â”€â”€ user456/
    â”œâ”€â”€ ... (similar structure)
    â””â”€â”€ conversations/ { ... }

admin_inbox/
â”œâ”€â”€ user123/
â”‚   â”œâ”€â”€ userId: "user123"
â”‚   â”œâ”€â”€ userName: "John"
â”‚   â”œâ”€â”€ userEmail: "john@gmail.com"
â”‚   â”œâ”€â”€ lastMessage: "Help please!"
â”‚   â”œâ”€â”€ lastMessageTime: 1701920400000
â”‚   â”œâ”€â”€ unreadCount: 1                â† Shows badge [1]
â”‚   â”œâ”€â”€ lastMessageFromUser: true
â”‚   â””â”€â”€ isResolved: false
â”‚
â”œâ”€â”€ user456/
â”‚   â”œâ”€â”€ userId: "user456"
â”‚   â”œâ”€â”€ userName: "Jane"
â”‚   â”œâ”€â”€ unreadCount: 0                â† No badge
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ user789/
    â”œâ”€â”€ userId: "user789"
    â”œâ”€â”€ userName: "Mike"
    â”œâ”€â”€ unreadCount: 3                â† Shows badge [3]
    â””â”€â”€ ...
```

## ğŸ” Access Control Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation           â”‚ User         â”‚ Admin           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ View own messages   â”‚ âœ“ Yes        â”‚ N/A             â”‚
â”‚ Send to admin       â”‚ âœ“ Yes        â”‚ N/A             â”‚
â”‚ View all users      â”‚ âœ— No         â”‚ âœ“ Yes           â”‚
â”‚ Send to user        â”‚ âœ— No         â”‚ âœ“ Yes           â”‚
â”‚ Open AdminInbox     â”‚ âœ— No         â”‚ âœ“ Yes           â”‚
â”‚ Mark as read        â”‚ âœ— No         â”‚ âœ“ Yes           â”‚
â”‚ Delete message      â”‚ (Not impl.)  â”‚ (Not impl.)     â”‚
â”‚ Search messages     â”‚ (Not impl.)  â”‚ (Not impl.)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## â±ï¸ Time Sequence Diagram

```
TIME         USER                    FIREBASE            ADMIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

12:00:00    Opens AdminChat
             "Hello?"  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Save to DB
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ user123/     â”‚
                       â”‚admin_support â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Update inbox
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚admin_inbox/  â”‚
                       â”‚user123: 1    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       Opens inbox
                                       Sees "user123" [1]
                                       
12:00:01                               Clicks user
                                       Opens chat
                                       â”€â†â”€ Load messages
                                       "Hello?" shown
                                       
12:00:02    Real-time listener       [streams message]
             Sees "Hello?"
             (blue bubble)
             
12:00:05                               Types "Hi!"
                                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Save to DB
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ user123/     â”‚
                       â”‚admin_reply   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Update inbox
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚admin_inbox/  â”‚
                       â”‚user123: 0    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

12:00:06    Real-time listener       [streams reply]
             Sees "Hi!"
             (gray bubble)
             Conversation active...
```

## ğŸ“Š Message Count Example

```
SCENARIO: Admin chat with 3 users

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ admin_inbox Collection (Firestore)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚ Document: user123                      â”‚
â”‚ â”œâ”€ lastMessageTime: 1701920400000      â”‚
â”‚ â”œâ”€ unreadCount: 0         â† Replied    â”‚
â”‚ â”œâ”€ lastMessage: "Thanks"               â”‚
â”‚ â””â”€ lastMessageFromUser: false          â”‚
â”‚                                        â”‚
â”‚ Document: user456                      â”‚
â”‚ â”œâ”€ lastMessageTime: 1701920500000      â”‚
â”‚ â”œâ”€ unreadCount: 2         â† Need reply â”‚
â”‚ â”œâ”€ lastMessage: "Still waiting..."     â”‚
â”‚ â””â”€ lastMessageFromUser: true           â”‚
â”‚                                        â”‚
â”‚ Document: user789                      â”‚
â”‚ â”œâ”€ lastMessageTime: 1701920300000      â”‚
â”‚ â”œâ”€ unreadCount: 1         â† Need reply â”‚
â”‚ â”œâ”€ lastMessage: "Can you help?"        â”‚
â”‚ â””â”€ lastMessageFromUser: true           â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total messages needing response: 2 + 1 = 3

Admin sees in inbox (sorted by newest):
1. user456: "Still waiting..." [2]      â† 2 messages
2. user123: "Thanks" [0]                â† Already replied
3. user789: "Can you help?" [1]         â† 1 message
```

## ğŸ¯ Decision Tree: Message Routing

```
Message created
        â”‚
        â”œâ”€ isUser = true?
        â”‚  â”‚
        â”‚  â””â”€ YES â”€â”€â”€â†’ Save to messages/{userUID}/admin_support/
        â”‚             â””â”€ Update admin_inbox/{userUID}
        â”‚                â””â”€ unreadCount += 1
        â”‚                â””â”€ lastMessageFromUser = true
        â”‚                â””â”€ Message appears in Admin Inbox [1]
        â”‚
        â””â”€ NO (Admin reply)
           â”‚
           â””â”€ Save to messages/{selectedUserUID}/admin_support/
              â””â”€ Update admin_inbox/{selectedUserUID}
                 â””â”€ unreadCount = 0
                 â””â”€ lastMessageFromUser = false
                 â””â”€ Message appears in User's chat
```

## ğŸ’¾ Database Write Checklist

When message is sent, verify these writes happen:

```
USER SENDS MESSAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Write 1: Message to Realtime DB
  Location: messages/{userUID}/admin_support/{msgId}
  Fields: id, chatId, content, timestamp, isUser, senderName, senderRole
  
âœ“ Write 2: Update Firestore conversation
  Location: users/{userUID}/conversations/admin_support
  Fields: lastUpdated = Timestamp.now()
  
âœ“ Write 3: Update Admin Inbox
  Location: admin_inbox/{userUID}
  Fields: lastMessage, lastMessageTime, unreadCount, lastMessageFromUser


ADMIN SENDS REPLY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Write 1: Reply to Realtime DB (USER's location!)
  Location: messages/{selectedUserUID}/admin_support/{msgId}
  Fields: id, chatId, content, timestamp, isUser=false, senderName, senderRole
  
âœ“ Write 2: Update Firestore conversation
  Location: users/{selectedUserUID}/conversations/admin_support
  Fields: lastUpdated = Timestamp.now()
  
âœ“ Write 3: Mark as Replied in Admin Inbox
  Location: admin_inbox/{selectedUserUID}
  Fields: unreadCount = 0, lastMessageFromUser = false
```

## ğŸ¨ Message Bubble Styles

```
USER MESSAGE (isUser = true)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Alignment: RIGHT
TextColor: text_primary
Background: bg_user (usually blue/light color)
Position: Right side of screen

Example display:
                            John
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Hello admin!     â”‚ â† Blue bubble
                    â”‚      12:30       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ADMIN MESSAGE (isUser = false)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Alignment: LEFT
TextColor: white
Background: bg_bot (usually gray/dark color)
Position: Left side of screen

Example display:
Support Team (admin)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hi there! How can    â”‚
â”‚ I help?              â”‚ â† Gray bubble
â”‚      12:31           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± Screen Layout Details

```
ADMIN CHAT ACTIVITY (User's view)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ Header (56dp) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† Back]  Chat with Admin Support                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  Sender Name                                         â”‚
â”‚  [Message Bubble] 12:30                              â”‚
â”‚                                                      â”‚
â”‚  Admin (admin)                                       â”‚
â”‚  [Message Bubble] 12:31                              â”‚
â”‚                                                      â”‚
â”‚  (Auto-scroll to bottom)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [TextField: "Type..."] [Send Btn]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADMIN DASHBOARD ACTIVITY (Admin's view)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ Header (56dp) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† Back]  Chat with John                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  John                                                â”‚
â”‚  [Message Bubble] 12:30                              â”‚
â”‚                                                      â”‚
â”‚  Support Team (admin)                                â”‚
â”‚  [Message Bubble] 12:31                              â”‚
â”‚                                                      â”‚
â”‚  (Auto-scroll to bottom)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [TextField: "Type..."] [Send Btn]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADMIN INBOX ACTIVITY (Admin's view)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ Header (56dp) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â† Back]  Tin nháº¯n chÆ°a tráº£ lá»i                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ [Avatar] John                          [3] â”‚ â† 3  â”‚
â”‚ â”‚          john@email.com                    â”‚   unr â”‚
â”‚ â”‚          "Can you help?" 5 min ago         â”‚   ead â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ [Avatar] Jane                          [1] â”‚      â”‚
â”‚ â”‚          jane@email.com                    â”‚      â”‚
â”‚ â”‚          "Hello" 10 min ago                â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ [Avatar] Mike                              â”‚ â† No â”‚
â”‚ â”‚          mike@email.com                    â”‚   badge â”‚
â”‚ â”‚          "Thanks!" 1 hour ago              â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**These diagrams should help visualize how the system works!**

Last Updated: December 7, 2024

